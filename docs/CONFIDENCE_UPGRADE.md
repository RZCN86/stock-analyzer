# ç½®ä¿¡åº¦è®¡ç®—ç³»ç»Ÿå‡çº§è¯´æ˜

## ğŸ¯ é—®é¢˜èƒŒæ™¯

**åŸæœ‰é—®é¢˜**ï¼šæ‰€æœ‰ç­–ç•¥åœ¨ HOLD çŠ¶æ€ä¸‹éƒ½è¿”å›å›ºå®šçš„ 0.5 ç½®ä¿¡åº¦ï¼Œæ— æ³•åæ˜ çœŸå®çš„å¸‚åœºä¿¡å·å¼ºåº¦ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»ºäº† `ConfidenceCalculator` ç½®ä¿¡åº¦è®¡ç®—å™¨ï¼ŒåŸºäºå¤šç»´åº¦å› ç´ è®¡ç®—çœŸå®çš„ä¿¡å·ç½®ä¿¡åº¦ã€‚

---

## âœ¨ æ”¹è¿›å†…å®¹

### 1. ç½®ä¿¡åº¦è®¡ç®—å™¨ (confidence_calculator.py)

æä¾›äº†å¤šç§æ ‡å‡†åŒ–çš„ç½®ä¿¡åº¦è®¡ç®—æ–¹æ³•ï¼š

#### è¶‹åŠ¿ç½®ä¿¡åº¦è®¡ç®—
```python
calculate_trend_confidence(
    current_value: float,
    benchmark: float,
    recent_values: pd.Series,
    direction: str
)
```
- åŸºäºä»·æ ¼åç¦»ç¨‹åº¦
- è€ƒè™‘è¶‹åŠ¿æ–¹å‘ä¸€è‡´æ€§
- å†å²æ•°æ®è¶‹åŠ¿ç¡®è®¤

#### äº¤å‰ä¿¡å·ç½®ä¿¡åº¦
```python
calculate_crossover_confidence(
    fast_value, slow_value,
    prev_fast, prev_slow,
    fast_series, slow_series
)
```
- äº¤å‰å¼ºåº¦è®¡ç®—
- è¶‹åŠ¿ç¡®è®¤åŠ æˆ
- è¿”å› (ä¿¡å·ç±»å‹, ç½®ä¿¡åº¦)

#### æç«¯å€¼ç½®ä¿¡åº¦
```python
calculate_extreme_confidence(
    value, lower_bound, upper_bound,
    recent_values, mean_reversion
)
```
- é€‚ç”¨äº RSIã€KDJ ç­‰æŒ‡æ ‡
- è€ƒè™‘åç¦»æç«¯ç¨‹åº¦
- åŒ…å«èƒŒç¦»æ£€æµ‹

#### çªç ´ç½®ä¿¡åº¦
```python
calculate_breakout_confidence(
    price, resistance, support,
    volume_ratio, lookback
)
```
- çªç ´/è·Œç ´å¼ºåº¦
- æˆäº¤é‡ç¡®è®¤
- æ”¯æ’‘é˜»åŠ›ä½è®¡ç®—

#### å¤šå› å­ç»¼åˆç½®ä¿¡åº¦
```python
calculate_multi_factor_confidence(
    factor_scores, factor_weights,
    threshold_buy, threshold_sell
)
```
- åŠ æƒå› å­è¯„åˆ†
- ä¸€è‡´æ€§è®¡ç®—
- é˜ˆå€¼åˆ¤æ–­

#### èƒŒç¦»æ£€æµ‹ç½®ä¿¡åº¦
```python
calculate_divergence_confidence(
    price_series, indicator_series, lookback
)
```
- é¡¶èƒŒç¦»æ£€æµ‹
- åº•èƒŒç¦»æ£€æµ‹
- èƒŒç¦»å¼ºåº¦è®¡ç®—

#### æ³¢åŠ¨æ€§è°ƒæ•´
```python
adjust_confidence_by_volatility(
    base_confidence, price_series,
    lookback, high_volatility_penalty
)
```
- é«˜æ³¢åŠ¨å¸‚åœºé™ä½ç½®ä¿¡åº¦
- åŸºäºå†å²æ³¢åŠ¨ç‡è°ƒæ•´

#### æˆäº¤é‡ç¡®è®¤
```python
calculate_volume_confidence(
    current_volume, avg_volume,
    price_change, direction
)
```
- é‡ä»·é…åˆåº¦
- æ”¾é‡/ç¼©é‡åˆ¤æ–­

---

### 2. ç­–ç•¥æ›´æ–°

å·²æ›´æ–°çš„ç­–ç•¥ï¼š
- âœ… **åŒå‡çº¿äº¤å‰ (MA Cross)**
- âœ… **MACDç­–ç•¥**
- âœ… **RSIè¶…ä¹°å–**
- â³ å…¶ä»–ç­–ç•¥å°†é€æ­¥æ›´æ–°

---

## ğŸ“Š ç½®ä¿¡åº¦ç­‰çº§åˆ’åˆ†

| ç­‰çº§ | èŒƒå›´ | è¯´æ˜ | æ“ä½œå»ºè®® |
|------|------|------|----------|
| ğŸ”´ é«˜ | â‰¥0.80 | ä¿¡å·å¼ºçƒˆï¼Œè¶‹åŠ¿æ˜ç¡® | æœæ–­æ‰§è¡Œ |
| ğŸŸ  ä¸­é«˜ | 0.60-0.80 | ä¿¡å·è¾ƒå¼ºï¼Œå»ºè®®å…³æ³¨ | è€ƒè™‘æ‰§è¡Œ |
| ğŸŸ¡ ä¸­ | 0.40-0.60 | ä¿¡å·ä¸­æ€§ï¼Œè¶‹åŠ¿ä¸æ˜ | è§‚æœ›ä¸ºä¸» |
| ğŸŸ¢ ä½ | <0.40 | ä¿¡å·å¾®å¼±ï¼Œè°¨æ…æ“ä½œ | æš‚ä¸æ‰§è¡Œ |

---

## ğŸ§® ç½®ä¿¡åº¦è®¡ç®—å› ç´ 

### 1. æŒ‡æ ‡åç¦»ç¨‹åº¦
- ä»·æ ¼/æŒ‡æ ‡åç¦»å‡çº¿çš„è·ç¦»
- åç¦»è¶Šå¤§ï¼Œç½®ä¿¡åº¦è¶Šé«˜ï¼ˆè¶‹åŠ¿è·Ÿè¸ªï¼‰
- åç¦»è¶Šå¤§ï¼Œåè½¬ä¿¡å·è¶Šå¼ºï¼ˆå‡å€¼å›å½’ï¼‰

### 2. è¶‹åŠ¿ä¸€è‡´æ€§
- è¿‘æœŸä»·æ ¼èµ°åŠ¿çš„ä¸€è‡´æ€§
- ä¸Šæ¶¨/ä¸‹è·Œé¢‘ç‡
- è¶‹åŠ¿è¶Šä¸€è‡´ï¼Œç½®ä¿¡åº¦è¶Šé«˜

### 3. äº¤å‰å¼ºåº¦
- é‡‘å‰/æ­»å‰çš„å¹…åº¦
- å¿«é€Ÿçº¿ä¸æ…¢é€Ÿçº¿çš„å·®è·
- å·®è·è¶Šå¤§ï¼Œä¿¡å·è¶Šå¼º

### 4. æˆäº¤é‡ç¡®è®¤
- æ”¾é‡ä¸Šæ¶¨/ä¸‹è·Œå¢åŠ ç½®ä¿¡åº¦
- ç¼©é‡ä¿¡å·å­˜ç–‘
- é‡ä»·èƒŒç¦»é™ä½ç½®ä¿¡åº¦

### 5. å¸‚åœºæ³¢åŠ¨æ€§
- é«˜æ³¢åŠ¨å¸‚åœºé™ä½ç½®ä¿¡åº¦
- ä½æ³¢åŠ¨å¸‚åœºä¿¡å·æ›´å¯é 
- æ ¹æ®ATRæˆ–å†å²æ³¢åŠ¨ç‡è°ƒæ•´

### 6. èƒŒç¦»æ£€æµ‹
- é¡¶èƒŒç¦»å¢åŠ å–å‡ºç½®ä¿¡åº¦
- åº•èƒŒç¦»å¢åŠ ä¹°å…¥ç½®ä¿¡åº¦
- èƒŒç¦»å¼ºåº¦å½±å“æœ€ç»ˆç½®ä¿¡åº¦

### 7. å¤šå› å­ä¸€è‡´æ€§
- å¤šä¸ªå› å­åŒå‘å¢åŠ ç½®ä¿¡åº¦
- å› å­åˆ†æ­§é™ä½ç½®ä¿¡åº¦
- ä¸€è‡´æ€§é€šè¿‡æ ‡å‡†å·®è¡¡é‡

---

## ğŸ“ˆ å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šåŒå‡çº¿äº¤å‰
```
ä¿¡å·: HOLD
ç½®ä¿¡åº¦: 0.5063 (ä¸­)
åŸå› : MA5åœ¨MA20ä¸Šæ–¹ï¼Œåç¦»åº¦0.21%

åˆ†æ: è™½ç„¶å‡çº¿å¤šå¤´æ’åˆ—ï¼Œä½†åç¦»åº¦å¾ˆå°ï¼Œ
     è¯´æ˜è¶‹åŠ¿ä¸å¼ºï¼Œç½®ä¿¡åº¦ä»…ç•¥é«˜äº0.5
```

### æ¡ˆä¾‹2ï¼šMACDç­–ç•¥
```
ä¿¡å·: HOLD  
ç½®ä¿¡åº¦: 0.5901 (ä¸­)
åŸå› : DIFåœ¨DEAä¸Šæ–¹ (åç¦»:18.03%)

åˆ†æ: MACDæŸ±çŠ¶å›¾ä¸ºæ­£ä¸”åç¦»åº¦è¾ƒå¤§ï¼Œ
     è¯´æ˜å¤šå¤´è¶‹åŠ¿å­˜åœ¨ä½†ä¸å¤Ÿå¼º
```

### æ¡ˆä¾‹3ï¼šå¤šå› å­ç»„åˆ
```
ä¿¡å·: SELL
ç½®ä¿¡åº¦: 0.8250 (é«˜)
åŸå› : å¤šå› å­å¾—åˆ†ç–²è½¯ (0.38); ä¿¡å·æ¥æº: MACDæ­»å‰, RSIæ­£å¸¸

åˆ†æ: å¤šä¸ªå› å­ç»¼åˆè¯„åˆ†ä½ï¼Œä¸€è‡´æ€§é«˜ï¼Œ
     å½¢æˆå¼ºçƒˆçš„å–å‡ºä¿¡å·
```

---

## ğŸ”§ å¦‚ä½•ä½¿ç”¨

### åœ¨ç­–ç•¥ä¸­é›†æˆ

```python
from strategy.confidence_calculator import ConfidenceCalculator

class MyStrategy(BaseStrategy):
    def get_current_signal(self, df):
        # è®¡ç®—æŒ‡æ ‡...
        
        # ä½¿ç”¨ç½®ä¿¡åº¦è®¡ç®—å™¨
        signal, confidence = ConfidenceCalculator.calculate_crossover_confidence(
            fast_value=latest['ma_fast'],
            slow_value=latest['ma_slow'],
            prev_fast=prev['ma_fast'],
            prev_slow=prev['ma_slow']
        )
        
        # æ ¹æ®æ³¢åŠ¨æ€§è°ƒæ•´
        confidence = ConfidenceCalculator.adjust_confidence_by_volatility(
            confidence, df['close']
        )
        
        return {
            'signal': signal,
            'confidence': confidence,
            'reason': '...'
        }
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç½®ä¿¡åº¦ä¸æ˜¯æ¦‚ç‡**
   - ç½®ä¿¡åº¦åæ˜ ä¿¡å·å¼ºåº¦ï¼Œä¸æ˜¯æˆåŠŸç‡
   - é«˜ç½®ä¿¡åº¦ â‰  100%ç›ˆåˆ©ä¿è¯

2. **å¸‚åœºç¯å¢ƒå½±å“**
   - ä¸åŒå¸‚åœºç¯å¢ƒä¸‹ç½®ä¿¡åº¦é˜ˆå€¼åº”ä¸åŒ
   - éœ‡è¡å¸‚åœºç½®ä¿¡åº¦æ™®éåä½
   - è¶‹åŠ¿å¸‚åœºç½®ä¿¡åº¦æ™®éåé«˜

3. **å»ºè®®ç»„åˆä½¿ç”¨**
   - å•ä¸€ç­–ç•¥ç½®ä¿¡åº¦æœ‰é™
   - å¤šç­–ç•¥å…±æŒ¯æ—¶ç½®ä¿¡åº¦æ›´å¯é 
   - ç»“åˆåŸºæœ¬é¢åˆ†ææ•ˆæœæ›´ä½³

4. **æŒç»­ä¼˜åŒ–**
   - æ ¹æ®å›æµ‹ç»“æœè°ƒæ•´å‚æ•°
   - ä¸åŒè‚¡ç¥¨å¯èƒ½éœ€è¦ä¸åŒé˜ˆå€¼
   - å®šæœŸè¯„ä¼°ç½®ä¿¡åº¦æœ‰æ•ˆæ€§

---

## ğŸ“ æ›´æ–°æ—¥å¿—

**2026-02-15**
- âœ… åˆ›å»º ConfidenceCalculator æ¨¡å—
- âœ… æ›´æ–° MA Cross ç­–ç•¥
- âœ… æ›´æ–° MACD ç­–ç•¥
- âœ… æ›´æ–° RSI ç­–ç•¥
- â³ å…¶ä»–ç­–ç•¥æ›´æ–°ä¸­...

---

## ğŸ¯ æœªæ¥è®¡åˆ’

1. **æœºå™¨å­¦ä¹ æ ¡å‡†**
   - ä½¿ç”¨å†å²æ•°æ®è®­ç»ƒç½®ä¿¡åº¦æ¨¡å‹
   - æ ¹æ®å›æµ‹ç»“æœè‡ªåŠ¨è°ƒæ•´æƒé‡

2. **ä¸ªæ€§åŒ–é…ç½®**
   - ä¸åŒç”¨æˆ·é£é™©åå¥½è®¾ç½®ä¸åŒé˜ˆå€¼
   - æ ¹æ®æŒä»“æƒ…å†µè°ƒæ•´ç½®ä¿¡åº¦è¦æ±‚

3. **å®æ—¶å­¦ä¹ **
   - æ ¹æ®äº¤æ˜“ç»“æœåé¦ˆè°ƒæ•´ç½®ä¿¡åº¦ç®—æ³•
   - æŒç»­ä¼˜åŒ–å„å› å­çš„æƒé‡åˆ†é…
