# è‚¡ç¥¨åˆ†æç³»ç»Ÿ (Stock Analyzer)

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æœ¬åœ°è‚¡ç¥¨åˆ†æç³»ç»Ÿï¼Œæ”¯æŒAè‚¡ã€ç¾è‚¡å’ŒETFçš„æ•°æ®è·å–ã€æŠ€æœ¯åˆ†æã€ç­–ç•¥å›æµ‹å’Œäº¤æ˜“ä¿¡å·ç”Ÿæˆã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š **å¤šå¸‚åœºæ”¯æŒ**: Aè‚¡ã€ç¾è‚¡ã€ETF
- ğŸ“ˆ **æŠ€æœ¯æŒ‡æ ‡**: MACDã€RSIã€KDJã€å¸ƒæ—å¸¦ã€å‡çº¿ç­‰
- ğŸ¯ **ç­–ç•¥äº¤æ˜“**: **12ç§**ç»å…¸é‡åŒ–ç­–ç•¥
- ğŸ“‰ **å›æµ‹ç³»ç»Ÿ**: åŸºäºVectorBTçš„é«˜æ€§èƒ½å›æµ‹
- ğŸ’¾ **æœ¬åœ°å­˜å‚¨**: SQLiteæ•°æ®åº“å­˜å‚¨å†å²æ•°æ®
- ğŸ“Š **å¯è§†åŒ–**: Kçº¿å›¾ã€æŠ€æœ¯æŒ‡æ ‡å›¾ã€èµ„é‡‘æ›²çº¿
- âš¡ **å¢é‡æ›´æ–°**: è‡ªåŠ¨æ£€æµ‹å¹¶ä¸‹è½½æœ€æ–°æ•°æ®
- ğŸŒ **Webç•Œé¢**: åŸºäºStreamlitçš„äº¤äº’å¼åˆ†æç•Œé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### è¿è¡Œæ–¹å¼

#### æ–¹å¼1: Webäº¤äº’ç•Œé¢ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨Webåº”ç”¨
python3 -m streamlit run web/app.py

# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
cd web && ./start.sh
```

ç„¶åæ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8501

#### æ–¹å¼2: å‘½ä»¤è¡Œæ¨¡å¼

```bash
python main.py
```

#### æ–¹å¼3: æ‰¹é‡åˆ†æ

```bash
python examples/batch_analysis.py
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
stock-analyzer/
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ settings.yaml    # å…¨å±€é…ç½®
â”‚   â””â”€â”€ strategies.yaml  # ç­–ç•¥é…ç½®
â”œâ”€â”€ data/                # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ raw/            # åŸå§‹æ•°æ®
â”‚   â””â”€â”€ processed/      # å¤„ç†åæ•°æ®
â”œâ”€â”€ database/           # æ•°æ®åº“æ¨¡å—
â”‚   â””â”€â”€ db_manager.py   # SQLiteç®¡ç†
â”œâ”€â”€ fetcher/            # æ•°æ®è·å–æ¨¡å—
â”‚   â”œâ”€â”€ base_fetcher.py    # åŸºç¡€æ¥å£
â”‚   â”œâ”€â”€ akshare_fetcher.py # Aè‚¡/ETFæ•°æ®
â”‚   â””â”€â”€ yfinance_fetcher.py # ç¾è‚¡æ•°æ®
â”œâ”€â”€ analysis/           # åˆ†ææ¨¡å—
â”‚   â””â”€â”€ indicators.py   # æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
â”œâ”€â”€ strategy/           # ç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ base_strategy.py   # ç­–ç•¥åŸºç±»
â”‚   â”œâ”€â”€ ma_strategy.py     # å‡çº¿ç­–ç•¥
â”‚   â”œâ”€â”€ macd_strategy.py   # MACDç­–ç•¥
â”‚   â”œâ”€â”€ rsi_strategy.py    # RSIç­–ç•¥
â”‚   â””â”€â”€ engine.py          # ç­–ç•¥å¼•æ“
â”œâ”€â”€ backtest/           # å›æµ‹æ¨¡å—
â”‚   â””â”€â”€ engine.py       # å›æµ‹å¼•æ“
â”œâ”€â”€ visualization/      # å¯è§†åŒ–æ¨¡å—
â”‚   â””â”€â”€ charts.py       # å›¾è¡¨ç»˜åˆ¶
â”œâ”€â”€ utils/              # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ config.py       # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ helpers.py      # è¾…åŠ©å‡½æ•°
â”œâ”€â”€ main.py             # ä¸»å…¥å£
â””â”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. æ•°æ®è·å–

```python
from stock_analyzer import StockAnalyzer

analyzer = StockAnalyzer()

# è·å–Aè‚¡æ•°æ®
df = analyzer.fetch_and_store("000001", market="A")

# è·å–ç¾è‚¡æ•°æ®
df = analyzer.fetch_and_store("AAPL", market="US")
```

### 2. æŠ€æœ¯åˆ†æ

```python
# åˆ†æè‚¡ç¥¨å¹¶è·å–äº¤æ˜“ä¿¡å·
result = analyzer.analyze("000001", market="A")

print(f"ç»¼åˆä¿¡å·: {result['final_signal']}")
print(f"ç½®ä¿¡åº¦: {result['confidence']}")

# å„ç­–ç•¥è¯¦æƒ…
for name, detail in result['details'].items():
    print(f"{name}: {detail['signal']} - {detail['reason']}")
```

### 3. ç­–ç•¥å›æµ‹

```python
# å›æµ‹MACDç­–ç•¥
backtest_result = analyzer.backtest(
    symbol="000001",
    strategy_name="macd",
    market="A",
    start_date="2022-01-01",
    end_date="2024-01-01"
)

print(f"æ€»æ”¶ç›Šç‡: {backtest_result['total_return_pct']}")
print(f"æœ€å¤§å›æ’¤: {backtest_result['max_drawdown_pct']}")
print(f"äº¤æ˜“æ¬¡æ•°: {backtest_result['total_trades']}")
```

### 4. ç»˜åˆ¶å›¾è¡¨

```python
# ç”Ÿæˆåˆ†æå›¾è¡¨
analyzer.plot_analysis("000001", save_dir="output/charts")
```

## ğŸ“Š æ”¯æŒçš„ç­–ç•¥ï¼ˆ12ç§ï¼‰

### è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥

| ç­–ç•¥åç§° | è¯´æ˜ | é£é™©ç­‰çº§ |
|---------|------|---------|
| **åŒå‡çº¿äº¤å‰** | çŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿ä¹°å…¥ï¼Œä¸‹ç©¿å–å‡º | ä¸­ |
| **MACD** | MACDé‡‘å‰ä¹°å…¥ï¼Œæ­»å‰å–å‡º | ä¸­ |
| **åŠ¨é‡ç­–ç•¥** | è¿½æ¶¨æ€è·Œï¼ŒåŸºäºä»·æ ¼å’Œæˆäº¤é‡åŠ¨é‡ | é«˜ |
| **çªç ´ç­–ç•¥** | çªç ´è¿‘æœŸé«˜ä½ç‚¹è¿›è¡Œäº¤æ˜“ | é«˜ |

### å‡å€¼å›å½’ç­–ç•¥

| ç­–ç•¥åç§° | è¯´æ˜ | é£é™©ç­‰çº§ |
|---------|------|---------|
| **RSIè¶…ä¹°å–** | RSIè¶…å–ä¹°å…¥ï¼Œè¶…ä¹°å–å‡º | ä¸­ |
| **å¸ƒæ—å¸¦çªç ´** | ä»·æ ¼çªç ´ä¸Šè½¨ä¹°å…¥ï¼Œè·Œç ´ä¸‹è½¨å–å‡º | ä¸­ |
| **å‡å€¼å›å½’** | ä»·æ ¼åç¦»å‡å€¼åå›å½’ï¼Œé€‚åˆéœ‡è¡å¸‚åœº | ä¸­ |
| **KDJéšæœºæŒ‡æ ‡** | åŸºäºKDJæŒ‡æ ‡çš„äº¤å‰å’Œè¶…ä¹°è¶…å– | ä¸­ |

### å…¶ä»–ç­–ç•¥

| ç­–ç•¥åç§° | è¯´æ˜ | é£é™©ç­‰çº§ |
|---------|------|---------|
| **æˆäº¤é‡ç­–ç•¥** | åŸºäºæˆäº¤é‡å˜åŒ–çš„é‡ä»·åˆ†æ | ä¸­ |
| **å¤šå› å­ç»„åˆ** | ç»¼åˆMAã€MACDã€RSIç­‰å¤šä¸ªå› å­ | ä½ |
| **ç½‘æ ¼äº¤æ˜“** | åœ¨ä»·æ ¼åŒºé—´å†…ä½ä¹°é«˜å–ï¼Œé€‚åˆéœ‡è¡å¸‚åœº | ä½ |
| **åˆ†å½¢äº¤æ˜“** | åŸºäºæ¯”å°”Â·å¨å»‰å§†æ–¯çš„åˆ†å½¢æŒ‡æ ‡ï¼Œè¯†åˆ«ä»·æ ¼åè½¬ç‚¹ | ä¸­ |

ğŸ“– [æŸ¥çœ‹è¯¦ç»†ç­–ç•¥è¯´æ˜](docs/STRATEGIES.md)

## âš™ï¸ é…ç½®è¯´æ˜

### å…¨å±€é…ç½® (config/settings.yaml)

```yaml
database:
  path: "data/stock_analyzer.db"  # æ•°æ®åº“è·¯å¾„

fetcher:
  akshare:
    rate_limit: 1.0  # è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼ˆç§’ï¼‰
    retry_times: 3   # é‡è¯•æ¬¡æ•°

update:
  start_date: "2020-01-01"  # é»˜è®¤èµ·å§‹æ—¥æœŸ
  adjust: "qfq"            # å¤æƒæ–¹å¼: qfq(å‰å¤æƒ)/hfq(åå¤æƒ)

backtest:
  initial_cash: 100000  # åˆå§‹èµ„é‡‘
  commission: 0.0003    # æ‰‹ç»­è´¹ç‡
  slippage: 0.001       # æ»‘ç‚¹
```

### ç­–ç•¥é…ç½® (config/strategies.yaml)

```yaml
strategies:
  ma_cross:
    enabled: true
    params:
      short_window: 5
      long_window: 20
    risk_management:
      stop_loss: 0.05    # æ­¢æŸæ¯”ä¾‹
      take_profit: 0.10  # æ­¢ç›ˆæ¯”ä¾‹
      max_position: 0.3  # æœ€å¤§ä»“ä½
```

## ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡

- **ç§»åŠ¨å¹³å‡çº¿ (MA)**: 5æ—¥ã€10æ—¥ã€20æ—¥ã€30æ—¥ã€60æ—¥
- **MACD**: DIFã€DEAã€æŸ±çŠ¶å›¾
- **RSI**: ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡
- **KDJ**: éšæœºæŒ‡æ ‡
- **å¸ƒæ—å¸¦**: ä¸Šè½¨ã€ä¸­è½¨ã€ä¸‹è½¨
- **ATR**: å¹³å‡çœŸå®æ³¢å¹…
- **æˆäº¤é‡MA**: æˆäº¤é‡ç§»åŠ¨å¹³å‡çº¿

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### æ‰¹é‡åˆ†æå…³æ³¨åˆ—è¡¨

```python
# å®šä¹‰å…³æ³¨åˆ—è¡¨
watchlist = [
    ("000001", "A"),  # å¹³å®‰é“¶è¡Œ
    ("000002", "A"),  # ä¸‡ç§‘A
    ("600519", "A"),  # è´µå·èŒ…å°
    ("AAPL", "US"),   # è‹¹æœ
    ("TSLA", "US"),   # ç‰¹æ–¯æ‹‰
]

# è·å–æ‰€æœ‰ä¿¡å·
signals_df = analyzer.get_watchlist_signals(watchlist)
print(signals_df)
```

### è‡ªå®šä¹‰ç­–ç•¥å‚æ•°

```python
from strategy.engine import StrategyEngine

engine = StrategyEngine()

# ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°åˆ›å»ºç­–ç•¥
strategy = engine.get_strategy('ma_cross', {
    'short_window': 10,
    'long_window': 30,
    'stop_loss': 0.03,
    'take_profit': 0.08
})
```

## âš ï¸ å…è´£å£°æ˜

æœ¬ç³»ç»Ÿä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚è‚¡å¸‚æœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…ã€‚

- å†å²å›æµ‹ç»“æœä¸ä»£è¡¨æœªæ¥æ”¶ç›Š
- äº¤æ˜“ä¿¡å·ä»…ä¾›å‚è€ƒï¼Œè¯·ç»“åˆè‡ªèº«åˆ¤æ–­
- å®ç›˜äº¤æ˜“è¯·è‡ªè¡Œæ‰¿æ‹…é£é™©

## ğŸ–¥ï¸ Webç•Œé¢åŠŸèƒ½

### ç•Œé¢é¢„è§ˆ

Webç•Œé¢æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **ğŸ“Š å®æ—¶è¡Œæƒ…æ˜¾ç¤º**
   - å½“å‰ä»·æ ¼ã€æ¶¨è·Œå¹…
   - ä»Šæ—¥æœ€é«˜/æœ€ä½ä»·
   - æˆäº¤é‡

2. **ğŸ¯ äº¤æ˜“ä¿¡å·åˆ†æ**
   - ç»¼åˆä¿¡å·ï¼ˆä¹°å…¥/å–å‡º/è§‚æœ›ï¼‰
   - å¤šç­–ç•¥ä¿¡å·å¯¹æ¯”
   - ç½®ä¿¡åº¦è¯„åˆ†

3. **ğŸ“ˆ æŠ€æœ¯åˆ†æå›¾è¡¨**
   - ä»·æ ¼èµ°åŠ¿å›¾ï¼ˆå«å‡çº¿ï¼‰
   - MACDæŒ‡æ ‡å›¾
   - RSIæŒ‡æ ‡å›¾
   - åŸå§‹æ•°æ®è¡¨æ ¼

4. **ğŸ“‰ ç­–ç•¥å›æµ‹**
   - æ”¶ç›Šç‡ç»Ÿè®¡
   - æœ€å¤§å›æ’¤åˆ†æ
   - èµ„é‡‘æ›²çº¿å›¾
   - äº¤æ˜“è®°å½•

### Webç•Œé¢ä½¿ç”¨æ­¥éª¤

```bash
# 1. å¯åŠ¨WebæœåŠ¡
python3 -m streamlit run web/app.py

# 2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:8501

# 3. åœ¨ä¾§è¾¹æ è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š000001ï¼‰

# 4. é€‰æ‹©å¸‚åœºç±»å‹ï¼ˆAè‚¡/ç¾è‚¡/ETFï¼‰

# 5. ç‚¹å‡»"æ›´æ–°æ•°æ®"è·å–æœ€æ–°è¡Œæƒ…

# 6. æŸ¥çœ‹åˆ†æç»“æœå’Œäº¤æ˜“ä¿¡å·
```

### ç•Œé¢æˆªå›¾

Webç•Œé¢åŒ…å«ï¼š
- **ä¾§è¾¹æ **: è‚¡ç¥¨ä»£ç è¾“å…¥ã€å¸‚åœºé€‰æ‹©ã€ç­–ç•¥é…ç½®
- **ä¸»é¡µé¢**: å®æ—¶è¡Œæƒ…å¡ç‰‡ã€äº¤æ˜“ä¿¡å·ã€æŠ€æœ¯åˆ†æå›¾è¡¨ã€å›æµ‹ç»“æœ

## ğŸ“ ä¾èµ–è¯´æ˜

ä¸»è¦ä¾èµ–åº“ï¼š

- **akshare**: Aè‚¡/æ¸¯è‚¡/ETFæ•°æ®è·å–
- **yfinance**: ç¾è‚¡æ•°æ®è·å–
- **pandas**: æ•°æ®å¤„ç†
- **vectorbt**: å›æµ‹å¼•æ“
- **mplfinance**: Kçº¿å›¾ç»˜åˆ¶
- **matplotlib**: å›¾è¡¨ç»˜åˆ¶
- **streamlit**: Webåº”ç”¨æ¡†æ¶

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPRï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [AKShare](https://www.akshare.xyz/) - æä¾›Aè‚¡æ•°æ®æ¥å£
- [yfinance](https://github.com/ranaroussi/yfinance) - æä¾›ç¾è‚¡æ•°æ®æ¥å£
- [vectorbt](https://vectorbt.dev/) - æä¾›å›æµ‹å¼•æ“
